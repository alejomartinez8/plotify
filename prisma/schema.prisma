generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

model Lot {
  id                      String                   @id @default(uuid())
  lotNumber               String                   @unique
  owner                   String
  ownerEmail              String?
  initialWorksDebt        Int                      @default(0)
  isExempt                Boolean                  @default(false)
  exemptionReason         String?
  collaboratorAssignments CollaboratorAssignment[]
  contributions           Contribution[]

  @@map("lots")
}

model Contribution {
  id              Int      @id @default(autoincrement())
  lotId           String
  type            String
  amount          Int
  description     String
  date            DateTime @default(now())
  receiptNumber   String?
  receiptFileId   String?
  receiptFileName String?
  receiptFileUrl  String?
  lot             Lot      @relation(fields: [lotId], references: [id])

  @@map("contributions")
}

model Expense {
  id              Int     @id @default(autoincrement())
  type            String  @default("general")
  amount          Int
  date            String
  description     String
  category        String
  receiptNumber   String?
  receiptFileId   String?
  receiptFileName String?
  receiptFileUrl  String?

  @@map("expenses")
}

model QuotaConfig {
  id          String    @id @default(uuid())
  year        Int
  month       Int?
  quotaType   String
  amount      Int
  description String?
  dueDate     DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())

  @@map("quota_configs")
}

model Collaborator {
  id             String                   @id @default(uuid())
  name           String
  photoFileId    String?
  photoFileName  String?
  photoFileUrl   String?
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  lotAssignments CollaboratorAssignment[]

  @@map("collaborators")
}

model CollaboratorAssignment {
  collaboratorId String
  lotId          String
  assignedAt     DateTime     @default(now())
  collaborator   Collaborator @relation(fields: [collaboratorId], references: [id], onDelete: Cascade)
  lot            Lot          @relation(fields: [lotId], references: [id], onDelete: Cascade)

  @@id([collaboratorId, lotId])
  @@map("collaborator_assignments")
}
